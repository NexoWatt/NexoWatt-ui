<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>NexoWatt SmartHome Konfiguration</title>
  <link href="/static/styles.css" rel="stylesheet"/>
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/nexowatt-32.png">
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#0c0f12">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="NexoWatt EMS">
</head>
<body>
<header class="topbar">
  <div class="brand">
    <a href="/" style="display:inline-flex;align-items:center;text-decoration:none;">
      <img alt="NexoWatt" src="/static/nexowatt-logo.png"/>
    </a>
  </div>
  <h1>SmartHome Konfiguration</h1>
</header>

<main class="content">
  <div id="nw-smarthome-config-root">
    <div class="nw-smarthome-header">
      <div>
        <div class="nw-smarthome-header__title">SmartHome-Konfiguration</div>
        <div class="nw-smarthome-header__subtitle">
          Bearbeiten von Räumen, Funktionen und Geräten aus dem SmartHomeConfig-Modell. Änderungen werden in der Adapter-Instanz gespeichert (BETA).
        </div>
      </div>
      <div class="nw-smarthome-header__right">
        <div class="nw-smarthome-header__actions">
          <button id="nw-config-save-btn" class="nw-config-btn nw-config-btn--primary" type="button">Speichern</button>
          <button id="nw-config-reload-btn" class="nw-config-btn nw-config-btn--ghost" type="button">Neu laden</button>
          <button id="nw-config-export-btn" class="nw-config-btn nw-config-btn--ghost" type="button">Export</button>
          <button id="nw-config-import-btn" class="nw-config-btn nw-config-btn--ghost" type="button">Import</button>
          <input id="nw-config-import-file" type="file" accept="application/json,.json" style="display:none;"/>
          <a class="nw-config-btn nw-config-btn--ghost" href="/smarthome.html">SmartHome öffnen</a>
	          <a class="nw-config-btn nw-config-btn--ghost" href="/logic.html">Logik öffnen</a>

        </div>
<div id="nw-config-status" class="nw-config-status"></div>
<div id="nw-config-enabled-hint" class="nw-config-status" style="display:none;margin-top:4px;color:#facc15;"></div>
      </div>
    </div>

    <section class="nw-config-section">
      <div id="nw-config-validation" class="nw-validation"></div>
    </section>

    <section class="nw-config-section">
      <div class="nw-config-section__head">
        <h2 class="nw-config-section__title">Navigation / Seiten (SmartHome VIS)</h2>
        <div class="nw-config-row__actions">
          <button id="nw-pages-default-btn" class="nw-config-btn nw-config-btn--ghost" type="button">Standard-Seiten</button>
          <button id="nw-pages-clear-btn" class="nw-config-btn nw-config-btn--ghost" type="button">Leeren</button>
          <button id="nw-pages-validate-btn" class="nw-config-btn nw-config-btn--ghost" type="button">Prüfen</button>
        </div>
      </div>

      <div class="nw-config-hint">
        <b>Neu:</b> Builder‑UI mit Picker für <code>Room/Function IDs</code>, Multi‑Level Navigation (Parent → Child) und page‑spezifische Layout‑Regeln.<br>
        (JSON bleibt als Experten‑Modus verfügbar.)
      </div>

      <div class="nw-tabs" id="nw-pages-tabs" style="margin-bottom: 10px;">
        <button type="button" class="nw-tab nw-tab--active" data-tab="builder">Builder</button>
        <button type="button" class="nw-tab" data-tab="json">JSON</button>
      </div>

      <div id="nw-pages-builder" class="nw-pages-builder">
        <div class="nw-pages-builder__layout">
          <div class="nw-pages-list">
            <div class="nw-pages-list__header">
              <div class="nw-pages-list__title">Seiten</div>
              <div class="nw-pages-list__actions">
                <button id="nw-page-add" class="nw-config-btn" type="button">+ Neu</button>
              </div>
            </div>
            <div id="nw-pages-list" class="nw-pages-list__body"></div>
            <div class="nw-config-hint" style="margin-top: 10px;">
              Tipp: Multi‑Level Navigation z.B. <b>Wohnzimmer</b> als Parent, darunter <b>Licht</b>/<b>Rollos</b>/<b>Heizung</b> als Kinder.
            </div>
          </div>

          <div class="nw-pages-editor">
            <div class="nw-pages-editor__head">
              <div class="nw-pages-editor__title" id="nw-page-editor-title">Seite bearbeiten</div>
              <div id="nw-page-editor-status" class="nw-config-status" style="margin-top:6px;"></div>
            </div>

            <div class="nw-config-form-grid" style="margin-top: 8px;">
              <div class="nw-config-row">
                <label class="nw-config-label" for="nw-page-title">Title</label>
                <input id="nw-page-title" class="nw-config-input" type="text" placeholder="z.B. Wohnzimmer" />
              </div>

              <div class="nw-config-row">
                <label class="nw-config-label" for="nw-page-icon">Icon</label>
                <select id="nw-page-icon" class="nw-config-select"></select>
              </div>

              <div class="nw-config-row">
                <label class="nw-config-label" for="nw-page-id">ID</label>
                <input id="nw-page-id" class="nw-config-input" type="text" placeholder="z.B. wohnzimmer" />
              </div>

              <div class="nw-config-row">
                <label class="nw-config-label" for="nw-page-parent">Parent (optional)</label>
                <select id="nw-page-parent" class="nw-config-select"></select>
              </div>

              <div class="nw-config-row">
                <label class="nw-config-label" for="nw-page-viewmode">View Mode</label>
                <select id="nw-page-viewmode" class="nw-config-select">
                  <option value="rooms">Rooms (Räume)</option>
                  <option value="functions">Functions (Funktionen)</option>
                </select>
              </div>

              <div class="nw-config-row">
                <label class="nw-config-label" for="nw-page-order">Order</label>
                <input id="nw-page-order" class="nw-config-input" type="number" step="1" value="0" />
              </div>

              <div class="nw-config-row" style="grid-column: 1 / -1;">
                <label class="nw-config-label" for="nw-page-rooms">Rooms (IDs)</label>
                <select id="nw-page-rooms" class="nw-config-select nw-multiselect" multiple size="6"></select>
              </div>

              <div class="nw-config-row" style="grid-column: 1 / -1;">
                <label class="nw-config-label" for="nw-page-functions">Functions (IDs)</label>
                <select id="nw-page-functions" class="nw-config-select nw-multiselect" multiple size="6"></select>
              </div>

              <div class="nw-config-row" style="grid-column: 1 / -1;">
                <label class="nw-config-label" for="nw-page-types">Types</label>
                <select id="nw-page-types" class="nw-config-select nw-multiselect" multiple size="6"></select>
                <div class="nw-config-row__actions" style="margin-top: 6px; justify-content: flex-start; gap: 8px;">
                  <input id="nw-page-type-add" class="nw-config-input" type="text" placeholder="Custom type (z.B. camera)" style="max-width: 260px;" />
                  <button id="nw-page-type-add-btn" class="nw-config-btn nw-config-btn--ghost" type="button">Hinzufügen</button>
                </div>
              </div>

              <div class="nw-config-row">
                <label class="nw-config-label" for="nw-page-sortby">Sortierung</label>
                <select id="nw-page-sortby" class="nw-config-select">
                  <option value="order">Order</option>
                  <option value="name">Name</option>
                  <option value="type">Type</option>
                </select>
              </div>

              <div class="nw-config-row">
                <label class="nw-config-label" for="nw-page-cardsize">Karten‑Größe</label>
                <select id="nw-page-cardsize" class="nw-config-select">
                  <option value="auto">Auto</option>
                  <option value="s">S</option>
                  <option value="m">M</option>
                  <option value="l">L</option>
                  <option value="xl">XL</option>
                </select>
              </div>

              <div class="nw-config-row" style="grid-column: 1 / -1;">
                <label class="nw-config-label">Optionen</label>
                <div class="nw-config-row__actions" style="justify-content:flex-start; gap: 14px;">
                  <label style="display:flex; gap:8px; align-items:center; cursor:pointer;">
                    <input id="nw-page-groupbytype" type="checkbox" />
                    <span>Gruppierung nach Gerätetyp (Option B)</span>
                  </label>
                  <label style="display:flex; gap:8px; align-items:center; cursor:pointer;">
                    <input id="nw-page-favonly" type="checkbox" />
                    <span>Nur Favoriten</span>
                  </label>
                </div>
              </div>

              <div class="nw-config-row" style="grid-column: 1 / -1;">
                <label class="nw-config-label" for="nw-page-href">Link (optional)</label>
                <input id="nw-page-href" class="nw-config-input" type="text" placeholder="z.B. /smarthome" />
              </div>
            </div>

            <div class="nw-config-row__actions" style="margin-top: 10px; justify-content: flex-start; gap: 8px;">
              <button id="nw-page-save" class="nw-config-btn" type="button">Speichern</button>
              <button id="nw-page-cancel" class="nw-config-btn nw-config-btn--ghost" type="button">Abbrechen</button>
              <button id="nw-page-delete" class="nw-config-btn nw-config-btn--danger" type="button">Löschen</button>
            </div>
          </div>
        </div>
      </div>

      <div id="nw-pages-json-wrap" style="display:none;">
        <textarea id="nw-pages-json" class="nw-config-input" rows="10" style="min-height:220px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;"></textarea>
        <div class="nw-config-row__actions" style="margin-top:8px; justify-content:flex-start; gap: 8px;">
          <button id="nw-pages-sync-from-json" class="nw-config-btn nw-config-btn--ghost" type="button">Aus JSON übernehmen</button>
          <button id="nw-pages-sync-to-json" class="nw-config-btn nw-config-btn--ghost" type="button">JSON aktualisieren</button>
        </div>
      </div>

      <div id="nw-pages-status" class="nw-config-status" style="margin-top:8px;"></div>
    </section>

<section class="nw-config-section">
      <div class="nw-config-section__head">
        <h2 class="nw-config-section__title">Datensicherung (wie App‑Center)</h2>
      </div>
      <div class="nw-config-hint">
        Export/Import der gesamten NexoWatt‑Konfiguration (enthält u.a. SmartHome + Logikeditor). So kannst du jederzeit wiederherstellen.
      </div>
      <div class="nw-config-form-grid">
        <div class="nw-config-row">
          <label class="nw-config-label">Import‑Modus</label>
          <select id="nw-backup-import-mode" class="nw-config-select">
            <option value="merge" selected>Merge (zusammenführen)</option>
            <option value="replace">Replace (ersetzen)</option>
          </select>
        </div>
      </div>
      <div class="nw-config-row__actions" style="margin-top:8px;">
        <button id="nw-backup-export-btn" class="nw-config-btn" type="button">Backup exportieren</button>
        <label class="nw-config-btn nw-config-btn--ghost" for="nw-backup-import-file" style="cursor:pointer;">Backup importieren</label>
        <input id="nw-backup-import-file" type="file" accept="application/json" style="display:none" />
        <button id="nw-backup-restore-userdata-btn" class="nw-config-btn nw-config-btn--ghost" type="button">Restore aus 0_userdata</button>
      </div>
      <div id="nw-backup-status" class="nw-config-status" style="margin-top:8px;"></div>
    </section>

    <section class="nw-config-section">
      <div class="nw-config-section__head">
        <h2 class="nw-config-section__title">Räume</h2>
        <button id="nw-config-add-room-btn" class="nw-config-btn nw-config-btn--ghost" type="button">+ Raum</button>
      </div>
      <div id="nw-config-rooms" class="nw-config-list"></div>
      <div id="nw-config-rooms-empty" class="nw-config-empty" style="display:none;">
        Keine Räume definiert. Nutze <strong>„+ Raum”</strong>, um einen Raum anzulegen.</div>
    </section>

    <section class="nw-config-section">
      <div class="nw-config-section__head">
        <h2 class="nw-config-section__title">Funktionen</h2>
        <button id="nw-config-add-function-btn" class="nw-config-btn nw-config-btn--ghost" type="button">+ Funktion</button>
      </div>
      <div id="nw-config-functions" class="nw-config-list"></div>
      <div id="nw-config-functions-empty" class="nw-config-empty" style="display:none;">
        Keine Funktionen definiert. Nutze <strong>„+ Funktion”</strong>, um eine Funktion anzulegen.</div>
    </section>

    <section class="nw-config-section">
      <div class="nw-config-section__head">
        <h2 class="nw-config-section__title">Geräte / Kacheln</h2>
        <div class="nw-config-row__actions">
          <select id="nw-config-template-select" class="nw-config-select" style="max-width:260px;">
	            <option value="">Vorlage…</option>
            <option value="switch">Schalter</option>
            <option value="dimmer">Dimmer</option>
            <option value="color">Farb‑Licht (RGB)</option>
            <option value="blind">Jalousie / Rollladen</option>
            <option value="rtr">Heizung (RTR)</option>
            <option value="sensor">Sensor</option>
            <option value="scene">Szene</option>
            <option value="player">Audio-Player</option>
            <option value="camera">Kamera</option>
            <option value="widget">Widget (Universal)</option>
          </select>
	          <button id="nw-config-add-template-btn" class="nw-config-btn nw-config-btn--ghost" type="button" title="Gerät aus Vorlage anlegen">+ Vorlage</button>
          <button id="nw-config-add-device-btn" class="nw-config-btn nw-config-btn--ghost" type="button">+ Gerät</button>
        </div>
      </div>
      <div id="nw-config-devices" class="nw-config-grid"></div>
      <div id="nw-config-devices-empty" class="nw-config-empty" style="display:none;">
        Keine Geräte/Kacheln definiert. Nutze <strong>„+ Gerät”</strong>, um eine Kachel anzulegen.</div>
    </section>
  </div>
</main>

<script src="/static/smarthome-config.js"></script>
</body>
</html>
